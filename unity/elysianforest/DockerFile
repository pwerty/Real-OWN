FROM ubuntu:22.04

# [1] 유니티 6 리눅스 플레이어가 요구하는 최소 시스템 라이브러리 설치
RUN apt-get update && apt-get install -y \
    libglu1-mesa libxcursor1 libxss1 libasound2 \
    libxrender1 libxext6 libxi6 libfontconfig1 \
    libxtst6 libpulse0 libwayland-client0 \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# [2] 젠킨스가 빌드한 모든 파일을 복사
COPY unity/elysianforest/Builds/Linux/ .

# [3] 실행 권한 부여
RUN chmod +x ./ElysianForest.x86_64

# [4] 핵심: 엔진(.so)이 현재 폴더(.)에 있다는 것을 리눅스에게 전달
ENV LD_LIBRARY_PATH=/app:$LD_LIBRARY_PATH

# [5] 실행 명령어 (ArgoCD 로그에서 확인 가능하도록 로그 출력 옵션 추가)
ENTRYPOINT ["./ElysianForest.x86_64", "-batchmode", "-nographics", "-logFile", "/dev/stdout"]